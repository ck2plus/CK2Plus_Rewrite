namespace = PlusAmbitions.bastard

#######################################
# BASTARD EVENTS
# Written by Rylock
#######################################

### BASTARD ASKS TO BE LEGITIMIZED

# Bastard has ambition to be legitimized
character_event = {
	id = PlusAmbitions.bastard.0000
	desc = EVTDESC_PlusAmbitions_bastard_0000
	picture = GFX_evt_son_asking_father
	
	min_age = 16
	max_age = 45
	capable_only = yes
	prisoner = no
	
	trigger = {
		trait = bastard
		has_ambition = obj_be_legitimized
		real_father = {
			plus_in_command_trigger  = no
			plus_is_abroad_trigger = no
			has_regent = no
			is_ruler = yes
			plus_is_not_busy_trigger = yes
			NOT = { is_inaccessible_trigger = yes }
		}
		NOR = {
			has_character_flag = refused_legitimacy_attempt
			is_inaccessible_trigger = yes
		}
		plus_is_not_busy_trigger = yes
	}
	
	mean_time_to_happen = {
		months = 30
		modifier = {
			factor = 2
			is_ruler = yes
		}
		modifier = {
			factor = 2
			is_female = yes
		}
		modifier = {
			factor = 0.5
			trait = ambitious
		}
		modifier = {
			factor = 0.75
			trait = proud
		}
		modifier = {
			factor = 0.75
			trait = envious
		}
		modifier = {
			factor = 1.5
			trait = patient
		}
		modifier = {
			factor = 1.5
			trait = trusting
		}
		modifier = {
			factor = 1.5
			trait = shy
		}
	}
	
	option = {
		name = EVTOPTA_PlusAmbitions_bastard_0000 #It's now or never...
		true_father_even_if_dead = {
			character_event = { id = PlusAmbitions.bastard.0001 days = 3 }
		}
		hidden_tooltip = {
			add_character_modifier = {
				name = plus_do_not_disturb
				hidden = yes
				days = 3
			}
		}
	}
}

# Bastard approaches father to ask to be legitimized
character_event = {
	id = PlusAmbitions.bastard.0001
	desc = EVTDESC_PlusAmbitions_bastard_0001
	picture = GFX_evt_son_asking_father
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_PlusAmbitions_bastard_0001 # It is not going to happen
		trigger = {
			NOT = { diplomacy = 14 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				FROM = { is_female = yes }
			}
			modifier = {
				factor = 2
				NOT = { religion = FROM }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 1.5
				NOT = { reverse_opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 1.5
				NOT = { reverse_opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 0.5
				is_married = no
				NOT = { num_of_children = 1 }
			}
			modifier = {
				factor = 1.5
				num_of_children = 3
			}
			modifier = {
				factor = 1.5
				num_of_children = 4
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = cruel
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 5
				current_heir = {
					is_child_of = ROOT
					NOT = { is_older_than = FROM }
				}
			}
		}
		hidden_tooltip = {
			FROM = {
				set_character_flag = refused_legitimacy_attempt
				character_event = { id = PlusAmbitions.bastard.0002 }
			}
		}
	}
	option = {
		name = EVTOPTB_PlusAmbitions_bastard_0001 # Convince him that this is for the best
		trigger = {
			diplomacy = 14
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				FROM = { is_female = yes }
			}
			modifier = {
				factor = 2
				NOT = { religion = FROM }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 1.5
				NOT = { reverse_opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 1.5
				NOT = { reverse_opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 0.5
				is_married = no
				NOT = { num_of_children = 1 }
			}
			modifier = {
				factor = 1.5
				num_of_children = 3
			}
			modifier = {
				factor = 1.5
				num_of_children = 4
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = cruel
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 5
				current_heir = {
					is_child_of = ROOT
					NOT = { is_older_than = FROM }
				}
			}
		}
		tooltip_info = diplomacy
		hidden_tooltip = {
			FROM = {
				set_character_flag = refused_legitimacy_attempt
				character_event = { id = PlusAmbitions.bastard.0003 }
			}
		}
	}
	option = {
		name = EVTOPTC_PlusAmbitions_bastard_0001 # Buy him an estate
		trigger = {
			wealth = 50
			FROM = {
				is_ruler = no
				spouse = { is_ruler = no }
				NOR = {
					has_character_modifier = plus_estates_1
				}
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 0 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 25 }
			}
			modifier = {
				factor = 0
				trait = greedy
			}
			modifier = {
				factor = 0
				has_character_modifier = plus_ai_austerity
			}
			modifier = {
				factor = 1.5
				wealth = 200
			}
			modifier = {
				factor = 1.5
				wealth = 400
			}
			modifier = {
				factor = 1.5
				trait = kind
			}
			modifier = {
				factor = 2
				trait = charitable
			}
		}
		wealth = -50
		FROM = {
			set_character_flag = refused_legitimacy_attempt
			character_event = { id = PlusAmbitions.bastard.0004 tooltip = plus_buy_off_with_estate }
		}
	}
	option = {
		name = EVTOPTD_PlusAmbitions_bastard_0001 # Legitimize him
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.75
				NOT = { age = 50 }
			}
			modifier = {
				factor = 0.5
				FROM = {
					OR = {
						trait = lunatic
						trait = possessed
						trait = drunkard
						trait = inbred
						is_weak_trigger = yes
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					OR = {
						is_smart_trigger = yes
						diplomacy = 12
						martial = 12
						stewardship = 12
						intrigue = 12
					}
				}
			}
			modifier = {
				factor = 0.5
				NOT = { religion = FROM }
			}
			modifier = {
				factor = 0.5
				NOT = { culture = FROM }
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 25 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 75 }
			}
			modifier = {
				factor = 1.5
				reverse_opinion = { who = FROM value = 25 }
			}
			modifier = {
				factor = 0
				NOT = { reverse_opinion = { who = FROM value = -50 } }
			}
			modifier = {
				factor = 0
				NOT = { piety = 50 }
			}
			modifier = {
				factor = 4
				OR = {
					has_law = succ_gavelkind
					has_law = succ_primogeniture
					has_law = succ_seniority
				}
				NOT = { has_law = enatic_succession }
				FROM = { is_female = no }
				spouse = { is_pregnant = no }
				current_heir = {
					NOT = { is_child_of = ROOT }
				}
			}
			modifier = {
				factor = 4
				OR = {
					has_law = succ_gavelkind
					has_law = succ_primogeniture
					has_law = succ_seniority
				}
				NOT = { has_law = agnatic_succession }
				FROM = { is_female = yes }
				spouse = { is_pregnant = no }
				current_heir = {
					NOT = { is_child_of = ROOT }
				}
			}
			modifier = {
				factor = 1.5
				trait = kind
			}
			modifier = {
				factor = 1.5
				trait = just
			}
			modifier = {
				factor = 1.5
				trait = honest
			}
			modifier = {
				factor = 0
				num_of_children = 5
			}
		}
		piety = -50
		FROM = {
			character_event = { id = PlusAmbitions.bastard.0005 tooltip = plus_legitimize_him }
		}
		hidden_tooltip = {
			FROM = {
				mother = {
					opinion = {
						who = ROOT
						modifier = legitimized_child
						years = 10
					}
				}
			}
			spouse = {
				if = {
					limit = {
						NOT = {
							any_child = { character = FROM }
						}
					}
					opinion = {
						who = ROOT
						modifier = legitimized_bastard
						years = 20
					}
				}
			}
			any_child = {
				limit = {
					NOT = { character = FROM }
					dynasty = ROOT
					NOT = { trait = bastard }
				}
				opinion = {
					who = ROOT
					modifier = legitimized_bastard
					months = 12
				}
			}
		}
	}

	}

# Father outright refuses to legitimize the bastard
character_event = {
	id = PlusAmbitions.bastard.0002
	desc = EVTDESC_PlusAmbitions_bastard_0002
	picture = GFX_evt_son_asking_father
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_PlusAmbitions_bastard_0002 # So be it
		ai_chance = {
			factor = 30
			modifier = {
				factor = 1.5
				trait = kind
			}
			modifier = {
				factor = 1.5
				trait = charitable
			}
			modifier = {
				factor = 1.5
				trait = patient
			}
			modifier = {
				factor = 0
				OR = {
					trait = lunatic
					trait = possessed
					trait = wroth
					trait = ambitious
				}
			}
		}
		opinion = {
			who = FROM
			modifier = opinion_very_disappointed
			years = 5
		}
		random = {
			chance = 50
			add_trait = content
		}
	}
	option = {
		name = EVTOPTB_PlusAmbitions_bastard_0002 # This isn't right!
		ai_chance = {
			factor = 70
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = envious
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = just
			}
		}
		set_character_flag = potential_trouble_bastard
		opinion = {
			who = FROM
			modifier = denounced_child
			years = 20
		}
		if = {
			limit = { NOT = { trait = wroth } }
			random = {
				chance = 20
				add_trait = wroth
			}
		}
		if = {
			limit = { NOT = { trait = ambitious } }
			random = {
				chance = 50
				add_trait = ambitious
			}
		}
	}
}

# Father diplomatically refuses to legitimize the bastard
character_event = {
	id = PlusAmbitions.bastard.0003
	desc = EVTDESC_PlusAmbitions_bastard_0003
	picture = GFX_evt_son_asking_father
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_PlusAmbitions_bastard_0002 # So be it
		opinion = {
			who = FROM
			modifier = opinion_very_disappointed
			years = 5
		}
		if = {
			limit = { trait = ambitious }
			random = {
				chance = 25
				remove_trait = ambitious
			}
		}
	}
}

# Father buys off the bastard with an estate
character_event = {
	id = PlusAmbitions.bastard.0004
	desc = EVTDESC_PlusAmbitions_bastard_0004
	picture = GFX_evt_son_asking_father
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_PlusAmbitions_bastard_0002 # So be it
		ai_chance = {
			factor = 70
			modifier = {
				factor = 1.5
				trait = kind
			}
			modifier = {
				factor = 1.5
				trait = charitable
			}
			modifier = {
				factor = 1.5
				trait = patient
			}
			modifier = {
				factor = 0
				OR = {
					trait = lunatic
					trait = possessed
				}
			}
			modifier = {
				factor = 0.1
				OR = {
					trait = wroth
					trait = ambitious
				}
			}
		}
		add_character_modifier = {
			name = "plus_estates_1"
			duration = -1
		}
		give_minor_title = title_lord
		random = {
			chance = 50
			add_trait = content
		}
	}
	option = {
		name = EVTOPTB_PlusAmbitions_bastard_0004 # That's not enough!
		ai_chance = {
			factor = 30
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = envious
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = just
			}
		}
		set_character_flag = potential_trouble_bastard
		add_character_modifier = {
			name = "plus_estates_1"
			duration = -1
		}
		give_minor_title = title_lord
		opinion = {
			who = FROM
			modifier = opinion_very_disappointed
			years = 5
		}
		if = {
			limit = { NOT = { trait = wroth } }
			random = {
				chance = 20
				add_trait = wroth
			}
		}
		if = {
			limit = { NOT = { trait = ambitious } }
			random = {
				chance = 50
				add_trait = ambitious
			}
		}
	}
}

# Father legitimizes the bastard
character_event = {
	id = PlusAmbitions.bastard.0005
	desc = EVTDESC_PlusAmbitions_bastard_0004
	picture = GFX_evt_son_asking_father
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		OR = {
			character = FROM
			is_close_relative = FROM
			dynasty = FROM
			vassal_of = FROM
			is_close_relative = ROOT
		}
	}
	
	option = {
		name = EXCELLENT
		trigger = { character = ROOT }
		opinion = {
			who = FROM
			modifier = plus_legitimized_me
			years = 20
		}
		set_father = FROM
		set_real_father = 0
		any_child = {
			limit = { dynasty = ROOT }
			dynasty = FROM
			any_child = {
				limit = { dynasty = ROOT }
				dynasty = FROM
			}
		}
		dynasty = FROM
		remove_trait = bastard
		add_trait = legit_bastard
		recalc_succession = yes
		if = {
			limit = { ai = no }
			chronicle = {
				entry = CHRONICLE_LEGITIMIZED_BY_FATHER
				portrait = [Root.GetID]
			}
		}
	}
	option = {
		name = OK
		trigger = { NOT = { character = ROOT } }
		if = {
			limit = { ai = no }
			chronicle = {
				entry = CHRONICLE_LEGITIMIZED_BY_FATHER
				portrait = [Root.GetID]
			}
		}
	}
}